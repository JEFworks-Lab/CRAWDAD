---
title: "Untitled"
author: "Brendan F. Miller"
date: "3/15/2023"
output: html_document
---

# Slide-seq co-occurance data

Load in the co-occurance array and intervals from the squidpy cooccurance analysis of the Slide-seq data.
Then, subsequently process and plot using R and ggplot2.

```{r, eval=FALSE}

slide <- read.csv2(file = paste0(here::here(), "/data/slideseq/slideseq.puck190926_08.rctd.meta.csv.gz"), row.names = 1, sep = ",")
slide <- slide[,c("x", "y", "class")]
## make sure the coordinates are numeric
slide <- slide %>%
  dplyr::mutate_at(vars(x, y), as.numeric)

## convert to SP
slide <- crawdad:::toSP(pos = slide[,c("x", "y")],
                        celltypes = slide$class)
slide

```

```{r}

occ <- readRDS(file = "/Users/brendan/Desktop/PostDoc/work/HuBMAP/repos/multiscale_celltype_colocalization_analysis/data/slideseq/slideseq.puck190926_08.rctd.co_occurance_array.rds")
occ[1,,]

```

```{r}

## celltype x celltype x interval
occ[,,1]

## is the data symmetrical? So it doesn't matter if rows or columns (first or second array indices) are used to plot the lines?
## maybe assume rows are the reference cell type anyways moving forward

```


```{r}

intervals <- readRDS(file = "/Users/brendan/Desktop/PostDoc/work/HuBMAP/repos/multiscale_celltype_colocalization_analysis/data/slideseq/slideseq.puck190926_08.rctd.co_occurance_intervals.rds")
intervals

```

intervals have 50 positions, but actually the points are for within an interval. So for simplicity sake, use the 2:50 intervals for plotting. Might be worth checking this in the python code to make sure

```{r}

astros <- occ[1,,]
rownames(astros) <- levels(slide$celltypes)
astros <- reshape2::melt(astros)
colnames(astros) <- c("exp", "distance", "value")

ggplot2::ggplot(data = astros) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))


dat <- astros[astros$exp == "Golgi",]
ggplot2::ggplot(data = dat) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

## Bergmann

```{r}

## folder on `brendan` branch
figpath <- paste0(here::here(), "/plots/slideseq")

```

```{r}

## Bergmann

df <- occ[2,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|Bergmann)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 12),
                   legend.title = ggplot2::element_blank(),
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S2_slideseq_berg_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))


# dat <- df[df$exp %in% c("Purkinje", "Bergmann", "MLI1", "MLI2"),]
# ggplot2::ggplot(data = dat) +
#   ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

## Purkinje

```{r}

df <- occ[18,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|Purkinje)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 12),
                   legend.title = ggplot2::element_blank(),
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S2_slideseq_purk_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))

```

## MLI1

```{r}

df <- occ[14,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|MLI1)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 12),
                   legend.title = ggplot2::element_blank(),
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S2_slideseq_mli1_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))

```

## MLI2

```{r}

df <- occ[15,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|MLI2)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 12),
                   legend.title = ggplot2::element_blank(),
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S2_slideseq_mli2_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))

```


Pairwise cell type comparisons are nearly identical. I don't necessarily see this symmetry with crawdad. What about the UBCs and Granule?

## Granule and UBCs

```{r}

## Granule

df <- occ[10,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))


dat <- df[df$exp == "UBCs",]
ggplot2::ggplot(data = dat) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

```{r}

## UBCs

df <- occ[19,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))


dat <- df[df$exp == "Granule",]
ggplot2::ggplot(data = dat) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

identical, but I don't see this with crawdad. Also, how does one interpret this plot? Compare it to self?

```{r}

## UBCs

df <- occ[19,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))


dat <- df[df$exp %in% c("Granule", "UBCs"),]
ggplot2::ggplot(data = dat) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

```{r}

## Granule

df <- occ[10,,]
rownames(df) <- levels(slide$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))


dat <- df[df$exp %in% c("Granule", "UBCs"),]
ggplot2::ggplot(data = dat) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

# seqFISH co-occurance data

```{r}
## the above dataset has been saved as an rda file and able to load here:
data(seq)

## convert to SP
seq <- crawdad:::toSP(pos = seq[,c("x", "y")],
                        celltypes = seq$celltypes)
seq

```

```{r}

## folder on `brendan` branch
figpath <- paste0(here::here(), "/plots/seqfish")

```

```{r}

occ <- readRDS(file = "/Users/brendan/Desktop/PostDoc/work/HuBMAP/repos/multiscale_celltype_colocalization_analysis/data/seqfish/sp.seqfish.co_occurance_array.rds")
occ[1,,]

```

## Intermediate mesoderm

```{r}

df <- occ[12,,]
rownames(df) <- levels(seq$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|Intermediate mesoderm)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 6),
                   legend.title = ggplot2::element_blank(),
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S3_seqfish_intMeso_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))


# dat <- df[df$exp %in% c("Purkinje", "Bergmann", "MLI1", "MLI2"),]
# ggplot2::ggplot(data = dat) +
#   ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

## Lateral plate mesoderm

```{r}

df <- occ[13,,]
rownames(df) <- levels(seq$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|Lateral plate mesoderm)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 6),
                   legend.title = ggplot2::element_blank()
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S3_seqfish_latMeso_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))


# dat <- df[df$exp %in% c("Purkinje", "Bergmann", "MLI1", "MLI2"),]
# ggplot2::ggplot(data = dat) +
#   ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

## Endothelium

```{r}

df <- occ[7,,]
rownames(df) <- levels(seq$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|Endothelium)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 6),
                   legend.title = ggplot2::element_blank()
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S3_seqfish_endo_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))


# dat <- df[df$exp %in% c("Purkinje", "Bergmann", "MLI1", "MLI2"),]
# ggplot2::ggplot(data = dat) +
#   ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```

## Haematoendothelial progenitors

```{r}

df <- occ[11,,]
rownames(df) <- levels(seq$celltypes)
df <- reshape2::melt(df)
colnames(df) <- c("exp", "distance", "value")

plt <- ggplot2::ggplot(data = df) +
  ggplot2::geom_line(ggplot2::aes(x = distance, y = value)) +
  ggplot2::facet_wrap(. ~ exp) +
  ggplot2::ggtitle(expression(frac("p(exp|Haematoendothelial progenitors)", "p(exp)"))) +
  ggplot2::theme_classic() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(size=12, color = "black", angle = -90, vjust = 0.5, hjust = 0),
                   axis.text.y = ggplot2::element_text(size=12, color = "black"),
                   axis.title.y = ggplot2::element_text(size=15),
                   axis.title.x = ggplot2::element_text(size=15),
                   axis.ticks.x = ggplot2::element_blank(),
                   plot.title = ggplot2::element_text(size=15),
                   plot.background = ggplot2::element_blank(),
                   legend.background = ggplot2::element_blank(),
                   panel.background = ggplot2::element_blank(),
                   panel.grid.major =  ggplot2::element_line(size = 0.1, colour = "black"),
                   panel.border = ggplot2::element_rect(colour = "black", fill=NA, size=1),
                   axis.line = ggplot2::element_line(size = 0, colour = "black"),
                   panel.spacing = ggplot2::unit(0.1, "lines"),
                   strip.text = ggplot2::element_text(size = 6),
                   legend.title = ggplot2::element_blank()
                   # legend.position="none"
    )

plt

ggplot2::ggsave(filename = "S3_seqfish_haem_cooccurance.pdf",
                plot = plt,
                device = "pdf",
                path = figpath,
                scale = 1,
                width = 8,
                height = 6,
                units = c("in"))


# dat <- df[df$exp %in% c("Purkinje", "Bergmann", "MLI1", "MLI2"),]
# ggplot2::ggplot(data = dat) +
#   ggplot2::geom_line(ggplot2::aes(x = distance, y = value, color = exp))

```


